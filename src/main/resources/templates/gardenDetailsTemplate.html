<!DOCTYPE html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <title>Garden Details</title>
    <link th:href="@{/css/stylesheet.css}" rel="stylesheet">
</head>
<body>

<nav th:insert="~{fragmentExample/fragments/navbar.html}"></nav>
<div class="container">
    <h1 class="garden-details-links">Garden Details
        <a th:href="@{../gardens/edit(gardenId=${garden.id})}" class="edit-garden-button">Edit Garden</a>
        <a th:href="@{../gardens/details/plants/form(gardenId=${garden.id})}" class="add-plant-button">Add New Plant</a>
    </h1>

    <div class="garden-details">
        <p><strong>Name:</strong> <span th:text="${garden.name}"></span></p>
        <p><strong>Location:</strong> <span th:text="${garden.location}"></span></p>
        <p>
            <strong>Size:</strong> <span th:if="${garden.size != null}" th:text="${garden.size + ' m^2'}"></span>
        </p>
    </div>
    <h4>Plants:</h4>
    <div th:if="${not #lists.isEmpty(garden.plants)}" class="plant-list-container">
        <table class="plant-table">
            <thead>
            <tr>
                <th>NAME</th>
                <th>IMAGE</th>
                <th>COUNT</th>
                <th>DESCRIPTION</th>
                <th></th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="plant: ${garden.plants}">
                <td th:text="${plant.name}"></td>
                <td>
                    <div class="plant-image-container" id="image">
                        <form class= "plant-image-container" th:id="'uploadPlantForm_' + ${plant.id}" th:action="@{../gardens/details/plants/image}" method="post" enctype="multipart/form-data">
                            <input type="hidden" th:name="plantId" th:value="${plant.id}" />
                            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
                            <img th:src="@{${plant.image}}" alt="Plant" th:id="'currentImage_' + ${plant.id}">
                            <button type="button" class="image-button" th:onclick="'handleImageClick(\'' + ${plant.id} + '\');'">+</button>
                            <input type="file" th:id="'fileInput_' + ${plant.id}" name="file" style="display: none;" accept="image/*" th:onchange="'handleImageChange(\'' + ${plant.id} + '\');'">
                        </form>
                    </div>
                    <span th:if="${uploadError} and ${plant.id} == ${errorId}" th:text="${uploadError}" class="errorMessage"></span>
                </td>
                <td th:if="${plant.count !=0}" th:text="${plant.count}"></td>
                <td th:if="${plant.count == 0}"></td>
                <td th:text="${plant.description}"></td>
                <td>
                    <form th:action="@{../gardens/details/plants/edit}" method="get">
                        <input type="hidden" th:name="plantId" th:value="${plant.id}" />
                        <button type="submit" class="button">Edit</button>
                    </form>
                </td>
            </tr>
            </tbody>
        </table>
    </div>
    <script>
        function handleImageClick(plantId) {
            document.getElementById('fileInput_' + plantId).click();
        }

        function handleImageChange(plantId) {
            document.getElementById('uploadPlantForm_' + plantId).submit();
        }
    </script>
</div>
</body>
</html>

