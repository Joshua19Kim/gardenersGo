<!DOCTYPE html>
<html lang="en">
<head>
    <meta content="text/html; charset=UTF-8" http-equiv="Content-Type">
    <title>Manage Friends</title>
    <link rel="stylesheet" th:href="@{css/stylesheet.css}">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">


</head>
<body>
<nav th:insert="~{fragmentExample/fragments/navbar.html}"></nav>
<div class="container">
    <div style="display: flex; justify-content: space-between">
        <h1>Manage Friends</h1>

        <div class="button-container">
            <button data-target="#add-friend-modal" data-toggle="modal" id="add-friend-button" class="button"
                    onclick="displaySearchBar()" type="button">Add Friend
            </button>
            <button data-target="#friend-request-modal" data-toggle="modal" id="friend-request-button" class="button"
                    onclick="displayFriendRequests()" type="button">Friend Requests
            </button>
        </div>
    </div>
    <div class="friendsContainer">
        <div class="friendManagement">
            <div class="friend-status">
                <span class="table-header">My Friends</span>
                <div class="table-body">
                    <!-- Iterate over search results -->
                    <div class="friend" th:each="friend : ${friends}">
                        <!-- Display gardener information -->
                        <img alt="Profile Picture" th:src="@{${'/images/' + friend.getProfilePicture()}}">
                        <p th:text="${friend.toString()}"></p>
                        <a th:href="@{../gardens(user=${friend.id})}">Gardens</a>
                    </div>
                </div>
            </div>

            <div aria-hidden="true" class="modal" id="friend-request-modal">
                <div class="friend-requests">
                    <div class="header">
                        <div class="table-header">
                            <button id="received-btn" onclick="displayRequest('received')">Received</button>
                            <button id="sent-btn" onclick="displayRequest('sent')">Sent</button>
                        </div>
                        <button class="close" onclick="displayFriendRequests()">&times;</button>
                    </div>
                    <div class="table-body">
                        <!-- Iterate over search results -->
                        <div id="sent-requests">
                            <div class="friend" th:each="pendingRequest : ${pending}">
                                <!-- Display gardener information -->
                                <div class="friend-info">
                                    <img alt="Profile Picture"
                                         th:src="@{${'/uploads/' + pendingRequest.getProfilePicture()}}">
                                    <p th:text="${pendingRequest.toString()}"></p>
                                </div>
                                <div class="friend-info">
                                    <p>Pending</p>
                                </div>
                            </div>
                            <div class="friend" th:each="declinedRequest : ${declined}">
                                <!-- Display gardener information -->
                                <div class="friend-info">
                                <img alt="Profile Picture"
                                     th:src="@{${'/uploads/' + declinedRequest.getProfilePicture()}}">
                                <p th:text="${declinedRequest.toString()}"></p>
                                </div>
                                <div class="friend-info">
                                <p>Declined</p>
                                </div>
                            </div>
                        </div>
                        <!-- Iterate over search results -->
                        <div class="friend" id="received-requests" th:each="receivedRequest : ${incoming}">
                            <!-- Display gardener information -->
                            <div class="friend-info">
                                <img alt="Profile Picture"
                                     th:src="@{${'/uploads/' + receivedRequest.getProfilePicture()}}">
                                <p th:text="${receivedRequest.toString()}"></p>
                            </div>
                            <div class="friend-info">
                                <form method="post" th:action="@{/manageRequest}" style="margin-right: 5px;">
                                    <input type="hidden"
                                           th:name="${_csrf.parameterName}"
                                           th:value="${_csrf.token}"/>
                                    <input name="friendId" th:value="${receivedRequest.getId()}" type="hidden">
                                    <input name="status" value="accepted" type="hidden">
                                    <button class="accept-friend-req-btn button">Accept</button>
                                </form>
                                <form method="post" th:action="@{/manageRequest}">
                                    <input type="hidden"
                                           th:name="${_csrf.parameterName}"
                                           th:value="${_csrf.token}"/>
                                    <input name="friendId" th:value="${receivedRequest.getId()}" type="hidden">
                                    <input name="status" value="declined" type="hidden">
                                    <button class="decline-friend-req-btn button">Decline</button>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div aria-hidden="true" class="modal" id="add-friend-modal">
                <div class="add-friends">
                    <div class="header">
                        <button class="close" onclick="displaySearchBar()">&times;</button>
                        <div class="search-table-header">
                            <h3>Find Gardeners</h3>
                        </div>
                    </div>
                    <div class="table-body">
                        <!-- https://www.w3schools.com/howto/howto_css_search_button.asp search bar and styling-->
                        <div class="input-search-bar">
                            <form class="search-bar"  method="post">
                                <input type="text" placeholder="Search...">
                                <button type="submit"><i class="fa fa-search"></i></button>
                            </form>
                        </div>
                        <div class="search-results">
                            <script>

                            </script>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    function displayFriendRequests() {
        const modal = document.getElementById("friend-request-modal");
        switch (modal.style.display) {
            case "":
                document.getElementById("friend-request-modal").style.display = "block";
                break;
            case "block":
                document.getElementById("friend-request-modal").style.display = "";
                break;
        }
    }

    function displaySearchBar() {
        const searchModal = document.getElementById("add-friend-modal");
        switch (searchModal.style.display) {
            case "":
                document.getElementById("add-friend-modal").style.display = "block";
                break;
            case "block":
                document.getElementById("add-friend-modal").style.display = "";
                break;
        }
    }

    function getSearchResults() {
        const searchQuery = document.getElementById("search-input").value;
    }

    function displayRequest(requestType) {
        const sentDiv = document.getElementById("sent-requests");
        const receivedDiv = document.getElementById("received-requests")
        if (requestType === "sent") {
            document.getElementById("sent-btn").style.background = "#45a049";
            document.getElementById("received-btn").style.background = "white";
            document.getElementById("received-btn").style.color = "black";
            document.getElementById("sent-btn").style.color = "white";
            // If there is a div, then hide/show it
            if (receivedDiv !== null) {
                receivedDiv.style.display = "none";
            }
            if (sentDiv !== null) {
                sentDiv.style.display = "block";
            }
        } else if (requestType === "received") {
            document.getElementById("sent-btn").style.background = "white";
            document.getElementById("received-btn").style.background = "#45a049";
            document.getElementById("received-btn").style.color = "white";
            document.getElementById("sent-btn").style.color = "black";
            // If there is a div, then hide/show it
            if (receivedDiv !== null) {
                receivedDiv.style.display = "flex";
            }
            if (sentDiv !== null) {
                sentDiv.style.display = "none";
            }
        }
    }

    document.addEventListener('DOMContentLoaded', function () {
        var toggleFriendBtns = document.querySelectorAll('.toggleFriendBtn');
        toggleFriendBtns.forEach(function (btn) {
            btn.addEventListener('click', function () {
                var email = this.getAttribute('data-email');
                var friendId = this.getAttribute('data-friendId');

                var form = document.createElement('form');
                form.setAttribute('method', 'post');
                form.setAttribute('action', '/addRelationship');

                var emailInput = document.createElement('input');
                emailInput.setAttribute('type', 'hidden');
                emailInput.setAttribute('name', 'email');
                emailInput.setAttribute('value', email);
                form.appendChild(emailInput);

                var friendIdInput = document.createElement('input');
                friendIdInput.setAttribute('type', 'hidden');
                friendIdInput.setAttribute('name', 'friendId');
                friendIdInput.setAttribute('value', friendId);
                form.appendChild(friendIdInput);

                document.body.appendChild(form);
                form.submit();
            });
        });
    });

</script>


</body>

</html>

<!--    <div class="searchBarContainer">-->
<!--        <form class="search" id="searchForm" method="post" th:action="@{manageFriends}">-->
<!--            <label for="searchQuery"> Search Gardeners: </label>-->
<!--            <input autofocus class="form-control" data-cy="searchQuery" id="searchQuery"-->
<!--                   name="searchQuery" placeholder="Search..." th:value="*{searchQuery}" type="text">-->
<!--            <button type="submit"><i class="fa fa-search"></i></button>-->
<!--        </form>-->
<!--    </div>-->

<!--<div class="displayResultsContainer">-->
<!--    <p th:text="${existingRelationshipErrorMessage}"></p>-->
<!--    <ul>-->
<!--        <li th:if="${foundGardeners != null and not foundGardeners.isEmpty()}">-->
<!--            &lt;!&ndash; Iterate over search results &ndash;&gt;-->
<!--            <ul th:each="gardener : ${foundGardeners}">-->
<!--                <li>-->
<!--                    &lt;!&ndash; Display gardener information &ndash;&gt;-->
<!--                    <span th:text="${gardener.getSearchResult()}"></span>-->
<!--                    <form action="/manageFriends" class="addFriendForm" method="post">-->
<!--                        <input name="email" th:value="${gardener.getEmail()}" type="hidden">-->
<!--                        <input name="friendId" th:value="${gardener.getId()}" type="hidden">-->
<!--                        <input th:name="${_csrf.parameterName}" th:value="${_csrf.token}" type="hidden"/>-->
<!--                        <button class="toggleFriendBtn" type="submit">Add friend</button>-->
<!--                    </form>-->
<!--                </li>-->
<!--            </ul>-->
<!--        </li>-->
<!--    </ul>-->
<!--    <span th:text="${emptySearchQueryMessage}"></span>-->
<!--</div>-->

<!--                    <form class="addFriendForm" action="/manageFriends" method="post">-->
<!--                        <input type="hidden" name="email" th:value="${gardener.getEmail()}">-->
<!--                        <input type="hidden" name="friendId" th:value="${gardener.getId()}">-->
<!--                        <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />-->
<!--                        <button class="toggleFriendBtn" type="submit">Add friend</button>-->
<!--                    </form>-->