<!DOCTYPE html>
<html lang="en">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <title>Manage Friends</title>
    <link rel="stylesheet" th:href="@{~/css/styles.css}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

</head>
<body>
<nav th:insert="~{fragmentExample/fragments/nav.html}"></nav>
<h1>Manage Friends</h1>

<div class="searchBarContainer">
    <form id="searchForm" class="search" th:action="@{manageFriends}" method="post">
        <label for="searchQuery"> Search Gardeners: </label>
        <input autofocus class="form-control" data-cy="searchQuery" id="searchQuery"
               placeholder="Search..." name="searchQuery" type="text" th:value="*{searchQuery}">
        <button type="submit"><i class="fa fa-search"></i></button>
    </form>
</div>

<div class="friendsContainer">
    <div class="displayResultsContainer">
        <h3 id="resultsListTitle">Gardeners</h3>
        <p th:text="${existingRelationshipErrorMessage}"></p>
        <ul>
            <li th:if="${foundGardeners != null and not foundGardeners.isEmpty()}">
                <!-- Iterate over search results -->
                <ul th:each="gardener : ${foundGardeners}">
                    <li>
                        <!-- Display gardener information -->
                        <span th:text="${gardener.getSearchResult()}"></span>
                        <form class="addFriendForm" action="/manageFriends" method="post">
                            <input type="hidden" name="email" th:value="${gardener.getEmail()}">
                            <input type="hidden" name="friendId" th:value="${gardener.getId()}">
                            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
                            <button class="toggleFriendBtn" type="submit">Add friend</button>
                        </form>
                    </li>
                </ul>
            </li>
        </ul>
        <span th:text="${emptySearchQueryMessage}"></span>
    </div>
    <div class="friendManagement">
        <h3>Manage my friends</h3>
<!--        <ul>-->
<!--            <li th:if="${foundGardeners != null and not foundGardeners.isEmpty()}">-->
<!--                &lt;!&ndash; Iterate over search results &ndash;&gt;-->
<!--                <ul th:each="gardener : ${foundGardeners}">-->
<!--                    <li>-->
<!--                        &lt;!&ndash; Display gardener information &ndash;&gt;-->
<!--                        <span th:text="${gardener.getSearchResult()}"></span>-->
<!--                        <form class="addFriendForm" action="/manageFriends" method="post">-->
<!--                            <input type="hidden" name="email" th:value="${gardener.getEmail()}">-->
<!--                            <input type="hidden" name="friendId" th:value="${gardener.getId()}">-->
<!--                            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />-->
<!--                            <button class="toggleFriendBtn" type="submit">Add friend</button>-->
<!--                        </form>-->
<!--                    </li>-->
<!--                </ul>-->
<!--            </li>-->
<!--        </ul>-->
    </div>
</div>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        var toggleFriendBtns = document.querySelectorAll('.toggleFriendBtn');
        toggleFriendBtns.forEach(function(btn) {
            btn.addEventListener('click', function() {
                var email = this.getAttribute('data-email');
                var friendId = this.getAttribute('data-friendId');

                var form = document.createElement('form');
                form.setAttribute('method', 'post');
                form.setAttribute('action', '/addRelationship');

                var emailInput = document.createElement('input');
                emailInput.setAttribute('type', 'hidden');
                emailInput.setAttribute('name', 'email');
                emailInput.setAttribute('value', email);
                form.appendChild(emailInput);

                var friendIdInput = document.createElement('input');
                friendIdInput.setAttribute('type', 'hidden');
                friendIdInput.setAttribute('name', 'friendId');
                friendIdInput.setAttribute('value', friendId);
                form.appendChild(friendIdInput);

                document.body.appendChild(form);
                form.submit();
            });
        });
    });

</script>

</body>

</html>